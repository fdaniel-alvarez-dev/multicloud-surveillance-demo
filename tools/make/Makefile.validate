SHELL := /usr/bin/env bash
MAKEFILE_DIR := $(realpath $(dir $(lastword $(MAKEFILE_LIST))))
REPO_ROOT := $(realpath $(MAKEFILE_DIR)/../..)

.PHONY: validate:repo
validate:repo:
	cd $(REPO_ROOT) && pre-commit run --all-files

.PHONY: validate:tf:static
validate:tf:static:
	cd $(REPO_ROOT) && ./tools/terraform/preflight.sh static

.PHONY: validate:tf:policy
validate:tf:policy:
	cd $(REPO_ROOT) && ./tools/terraform/preflight.sh policy

.PHONY: validate:tf:plan-local
validate:tf:plan-local:
	cd $(REPO_ROOT) && ./tools/terraform/plan_local.sh

.PHONY: validate:cost
validate:cost:
	cd $(REPO_ROOT) && MAX_MONTHLY_DELTA=$${MAX_MONTHLY_DELTA:-50} ./tools/cost/estimate.sh

.PHONY: validate:k8s:local
validate:k8s:local:
	cd $(REPO_ROOT) && ./tools/k8s/validate.sh

.PHONY: validate:smoke:offline
validate:smoke:offline:
	cd $(REPO_ROOT) && ./tools/tests/offline_smoke.sh
